<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.teamx.respets.user.mapper.UserMapper">
	
	<!-- 회원 정보 조회 -->
	<select id="selectMyInfo" parameterType="map" resultType="map">
		SELECT *
		FROM PERSONAL_TB 
		WHERE PER_NO = #{no}
	</select>
	
	<!-- 비밀번호 확인 -->
	<select id="myPwCheck" resultType="Integer" parameterType="map">
		SELECT COUNT(*) 
		FROM PERSONAL_TB 
		WHERE PER_NO = #{per_no} 
			AND PER_PW = #{per_pw}
	</select>
	
	<!-- 개인 회원탈퇴 -->
	<update id="deleteUser" parameterType="String">
		UPDATE PERSONAL_TB 
		SET PER_LEAVE = 'O', PER_LEAVE_DT = NOW() 
		WHERE PER_NO = #{no}
	</update>
	
	<!-- 개인 정보수정 -->
	<update id="updateUserInfo" parameterType="map">
		UPDATE PERSONAL_TB 
		SET PER_PHONE = #{per_phone}
		<if test="per_file_id != ''.toString() and per_file_id != null">
			,PER_FILE_ID = #{per_file_id}
		</if>
		WHERE PER_NO = #{per_no}
	</update>
	
</mapper>


<!-- 
DROP VIEW LOGIN_VIEW;
CREATE VIEW LOGIN_VIEW AS
SELECT PER_NO AS NO, PER_EMAIL AS EMAIL, PER_PW AS PW, PER_NAME AS NAME
, PER_PHONE AS PHONE, (SELECT FILE_COURS FROM FILE_TB WHERE FILE_ID=PER_FILE_ID) AS FILE_ID, PER_EMCHK AS EMCHK, PER_LEAVE AS LEAVE
, 'P' AS TYPE
FROM PERSONAL_TB
UNION
SELECT BUS_NO, BUS_EMAIL, BUS_PW, BUS_NAME, BUS_PHONE, (SELECT FILE_COURS FROM FILE_TB WHERE FILE_ID=BUS_FILE_ID) AS BUS_FILE_ID, BUS_EMCHK, BUS_LEAVE
, 'B' AS TYPE
FROM BUSINESS_TB; 
 -->