<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.teamx.respets.user.mapper.UserMapper">
	
	<!-- 회원 정보 조회 -->
	<select id="selectMyInfo" parameterType="map" resultType="camelMap">
		SELECT *
		FROM PERSONAL_TB 
		WHERE PER_NO = #{no}
	</select>
	
	<!-- 개인 회원탈퇴 -->
	<update id="deleteUser" parameterType="String">
		UPDATE PERSONAL_TB 
		SET PER_LEAVE = 'O', PER_LEAVE_DT = NOW() 
		WHERE PER_NO = #{no}
	</update>
	
	<!-- 개인 정보수정 -->
	<update id="updateUserInfo" parameterType="map">
		UPDATE PERSONAL_TB 
		SET PER_PHONE = #{perPhone}
		<if test="perFileId != ''.toString() and perFileId != null">
			,PER_FILE_ID = #{perFileId}
		</if>
		WHERE PER_NO = #{perNo}
	</update>
	
	<!-- 회원 정보 조회 -->
	<select id="selectLikeBusiness" parameterType="map" resultType="camelMap">
		SELECT BUS_NO
			,BUS_NAME
			,(SELECT FILE_COURS FROM FILE_TB WHERE FILE_ID=BUS_FILE_ID) BUS_FILE_COURS
			,(SELECT SVC_CD FROM SERVICE_TB ST WHERE ST.BUS_NO=BT.BUS_NO AND SVC_SORT=1) SVC_CD
		FROM BUSINESS_TB BT
		WHERE BUS_NO = (SELECT BUS_NO FROM FAVORITE_TB WHERE PER_NO=#{no})
	</select>
	
	<delete id="deleteLikeBusiness" parameterType="map">
		DELETE FROM FAVORITE_TB
		WHERE BUS_NO=#{busNo}
			AND PER_NO=#{perNo}
	</delete>
</mapper>


<!-- 
DROP VIEW LOGIN_VIEW;
CREATE VIEW LOGIN_VIEW AS
SELECT PER_NO AS NO, PER_EMAIL AS EMAIL, PER_PW AS PW, PER_NAME AS NAME
, PER_PHONE AS PHONE, (SELECT FILE_COURS FROM FILE_TB WHERE FILE_ID=PER_FILE_ID) AS FILE_ID, PER_EMCHK AS EMCHK, PER_LEAVE AS LEAVE
, 'P' AS TYPE
FROM PERSONAL_TB
UNION
SELECT BUS_NO, BUS_EMAIL, BUS_PW, BUS_NAME, BUS_PHONE, (SELECT FILE_COURS FROM FILE_TB WHERE FILE_ID=BUS_FILE_ID) AS BUS_FILE_ID, BUS_EMCHK, BUS_LEAVE
, 'B' AS TYPE
FROM BUSINESS_TB; 
 -->